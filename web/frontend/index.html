<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Autocomplete · Setup</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #0b0c0f;
      --surface:  #13151a;
      --border:   #222530;
      --accent:   #4fffb0;
      --accent2:  #6c63ff;
      --text:     #e8eaf0;
      --muted:    #5a5f72;
      --danger:   #ff5a6e;
      --success:  #4fffb0;
      --radius:   12px;
      --font:     'Syne', sans-serif;
      --mono:     'DM Mono', monospace;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* ── Animated grid background ── */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(79,255,176,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(79,255,176,.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* ── Glowing orbs ── */
    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      pointer-events: none;
      z-index: 0;
      animation: drift 12s ease-in-out infinite alternate;
    }
    .orb-1 { width: 400px; height: 400px; background: rgba(108,99,255,.18); top: -100px; right: -80px; }
    .orb-2 { width: 300px; height: 300px; background: rgba(79,255,176,.12); bottom: -80px; left: -60px; animation-delay: -6s; }

    @keyframes drift {
      from { transform: translate(0, 0) scale(1); }
      to   { transform: translate(30px, 20px) scale(1.05); }
    }

    /* ── Card ── */
    .card {
      position: relative;
      z-index: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 48px 52px;
      width: 480px;
      max-width: 95vw;
      box-shadow: 0 0 0 1px rgba(79,255,176,.06), 0 24px 80px rgba(0,0,0,.6);
      animation: slideUp .5s cubic-bezier(.22,1,.36,1) both;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(28px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ── Header ── */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(79,255,176,.08);
      border: 1px solid rgba(79,255,176,.2);
      border-radius: 100px;
      padding: 4px 12px;
      font-size: 11px;
      font-family: var(--mono);
      color: var(--accent);
      letter-spacing: .08em;
      text-transform: uppercase;
      margin-bottom: 20px;
    }
    .badge::before {
      content: '';
      width: 6px; height: 6px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--accent);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50%       { opacity: .4; }
    }

    h1 {
      font-size: 28px;
      font-weight: 800;
      line-height: 1.15;
      margin-bottom: 8px;
      letter-spacing: -.02em;
    }
    h1 span { color: var(--accent); }

    .subtitle {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 36px;
      font-weight: 400;
      font-family: var(--mono);
    }

    /* ── Status bar ── */
    #statusBar {
      display: none;
      align-items: center;
      gap: 10px;
      background: rgba(79,255,176,.07);
      border: 1px solid rgba(79,255,176,.15);
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 24px;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--accent);
      animation: fadeIn .3s ease;
    }
    #statusBar.error {
      background: rgba(255,90,110,.07);
      border-color: rgba(255,90,110,.2);
      color: var(--danger);
    }
    #statusBar.visible { display: flex; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ── Form ── */
    .field { margin-bottom: 20px; }

    label {
      display: block;
      font-size: 12px;
      font-family: var(--mono);
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .08em;
      margin-bottom: 8px;
    }

    select, input[type="text"] {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-family: var(--mono);
      font-size: 14px;
      padding: 12px 16px;
      outline: none;
      transition: border-color .2s, box-shadow .2s;
      appearance: none;
      -webkit-appearance: none;
    }

    select:focus, input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79,255,176,.1);
    }

    /* Custom select arrow */
    .select-wrap {
      position: relative;
    }
    .select-wrap::after {
      content: '▾';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
      font-size: 12px;
    }

    /* Custom language input (for freeform) */
    #langCustom {
      display: none;
      margin-top: 10px;
    }

    /* ── Submit button ── */
    .btn {
      width: 100%;
      background: var(--accent);
      color: #0b0c0f;
      border: none;
      border-radius: var(--radius);
      font-family: var(--font);
      font-size: 15px;
      font-weight: 700;
      padding: 14px;
      cursor: pointer;
      margin-top: 8px;
      letter-spacing: .01em;
      position: relative;
      overflow: hidden;
      transition: opacity .2s, transform .15s;
    }
    .btn:hover:not(:disabled)  { opacity: .9; transform: translateY(-1px); }
    .btn:active:not(:disabled) { transform: translateY(0); }
    .btn:disabled { opacity: .5; cursor: not-allowed; }

    /* Shimmer on loading */
    .btn.loading::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.25) 50%, transparent 100%);
      animation: shimmer 1s linear infinite;
    }
    @keyframes shimmer {
      from { transform: translateX(-100%); }
      to   { transform: translateX(100%); }
    }

    /* ── Current config display ── */
    #currentConfig {
      display: none;
      margin-top: 28px;
      background: rgba(108,99,255,.08);
      border: 1px solid rgba(108,99,255,.2);
      border-radius: var(--radius);
      padding: 16px 20px;
      animation: fadeIn .4s ease;
    }
    #currentConfig.visible { display: block; }

    .config-label {
      font-size: 10px;
      font-family: var(--mono);
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .1em;
      margin-bottom: 8px;
    }
    .config-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--mono);
      font-size: 13px;
    }
    .config-key  { color: var(--muted); }
    .config-val  { color: var(--accent2); font-weight: 500; }

    /* ── Divider ── */
    .divider {
      height: 1px;
      background: var(--border);
      margin: 28px 0;
    }
  </style>
</head>
<body>

  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="card">
    <div class="badge">API Configuration</div>
    <h1>Set Region &amp; <span>Language</span></h1>
    <p class="subtitle">Configure the autocomplete service before use.</p>

    <!-- Status message bar -->
    <div id="statusBar"></div>

    <!-- Config form -->
    <form id="configForm" novalidate>

      <div class="field">
        <label for="regionSelect">Region</label>
        <div class="select-wrap">
          <select id="regionSelect" name="region" required>
            <option value="" disabled selected>Select a region…</option>
            <option value="nep">Nepal</option>
            <option value="ind">India</option>
            <option value="bang">Bangladesh</option>
            <option value="sri">Sri Lanka</option>
            <option value="global">Other…</option>
          </select>
        </div>
        <!-- Shown when "Other" is picked -->
        <input type="text" id="regionCustom" placeholder="Enter region name…" style="display:none; margin-top:10px;" />
      </div>

      <div class="field">
        <label for="langSelect">Language</label>
        <div class="select-wrap">
          <select id="langSelect" name="language" required>
            <option value="" disabled selected>Select a language…</option>
            <option value="nep">Nepali (nep)</option>
            <option value="eng">English (eng)</option>
            <option value="hindi">Hindi (hin)</option>
            <option value="kannada">Kannada (kan)</option>
            <option value="tamil">Tamil (tam)</option>
            <option value="sanskrit">Sanskrit (san)</option>
            <option value="punjabi">Punjabi (pun)</option>
            <option value="gujarati">Gujarati (guj)</option>
            <option value="bengali">Bengali (ben)</option>
            <option value="sin">Sinhala (sin)</option>
            <option value="other">Other…</option>
          </select>
        </div>
        <input type="text" id="langCustom" placeholder="Enter language code (e.g. tam)…" />
      </div>

      <button class="btn" type="submit" id="submitBtn">Apply Configuration</button>
    </form>

    <!-- Currently active config (shown after success or on page load if already set) -->
    <div id="currentConfig">
      <div class="config-label">Active Configuration</div>
      <div class="config-row" style="margin-bottom:6px;">
        <span class="config-key">region</span>
        <span class="config-val" id="cfgRegion">—</span>
      </div>
      <div class="config-row">
        <span class="config-key">language</span>
        <span class="config-val" id="cfgLang">—</span>
      </div>
    </div>
  </div>

<script>
  // ── Point directly at your FastAPI server — change port if needed ─────────
  const API = 'http://127.0.0.1:8000';

  // ── DOM refs ──────────────────────────────────────────────────────────────
  const form          = document.getElementById('configForm');
  const submitBtn     = document.getElementById('submitBtn');
  const statusBar     = document.getElementById('statusBar');
  const currentConfig = document.getElementById('currentConfig');
  const regionSelect  = document.getElementById('regionSelect');
  const regionCustom  = document.getElementById('regionCustom');
  const langSelect    = document.getElementById('langSelect');
  const langCustom    = document.getElementById('langCustom');

  // ── Show "Other" input fields when selected ───────────────────────────────
  regionSelect.addEventListener('change', () => {
    regionCustom.style.display = regionSelect.value === 'other' ? 'block' : 'none';
    if (regionSelect.value !== 'other') regionCustom.value = '';
  });

  langSelect.addEventListener('change', () => {
    langCustom.style.display = langSelect.value === 'other' ? 'block' : 'none';
    if (langSelect.value !== 'other') langCustom.value = '';
  });

  // ── Status bar helper ─────────────────────────────────────────────────────
  function showStatus(msg, isError = false) {
    statusBar.textContent = msg;
    statusBar.className   = 'visible' + (isError ? ' error' : '');
  }

  function hideStatus() {
    statusBar.className = '';
  }

  // ── Show current config panel ─────────────────────────────────────────────
  function showCurrentConfig(region, language) {
    document.getElementById('cfgRegion').textContent = region;
    document.getElementById('cfgLang').textContent   = language;
    currentConfig.classList.add('visible');
  }

  // ── Check status on page load ─────────────────────────────────────────────
  async function checkStatus() {
    try {
      const res  = await fetch(`${API}/autocomplete/status`);
      const data = await res.json();
      if (data.ready) {
        showCurrentConfig(data.region, data.language);
        showStatus(`✓ Service is running — ${data.region} / ${data.language}`);
      } else {
        showStatus('API is up. Select region & language to initialize.', false);
      }
    } catch (e) {
      showStatus('⚠ Cannot reach API server at ' + API, true);
    }
  }

  // ── Form submit → POST directly to FastAPI ────────────────────────────────
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const region   = regionSelect.value === 'other'
      ? regionCustom.value.trim().toLowerCase()
      : regionSelect.value;

    const language = langSelect.value === 'other'
      ? langCustom.value.trim().toLowerCase()
      : langSelect.value;

    if (!region || !language) {
      showStatus('Please select or enter both region and language.', true);
      return;
    }

    // Loading state
    submitBtn.disabled    = true;
    submitBtn.textContent = 'Initializing…';
    submitBtn.classList.add('loading');
    hideStatus();

    try {
      const res  = await fetch(`${API}/autocomplete/config`, {
        method:  'POST',
        headers: { 'Content-Type': 'application/json' },
        body:    JSON.stringify({ region, language }),
      });

      const data = await res.json();

      if (res.ok && data.status === 'configured') {
        showStatus(`✓ Configured successfully: ${data.region} / ${data.language}`);
        showCurrentConfig(data.region, data.language);
      } else {
        showStatus(data.detail || data.error || 'Configuration failed.', true);
      }

    } catch (err) {
      showStatus('Network error — is the API server running on ' + API + '?', true);
    } finally {
      submitBtn.disabled    = false;
      submitBtn.textContent = 'Apply Configuration';
      submitBtn.classList.remove('loading');
    }
  });

  // ── Init ──────────────────────────────────────────────────────────────────
  checkStatus();
</script>
</body>
</html>